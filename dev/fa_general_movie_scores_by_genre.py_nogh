import pandas as pd

# Read table cleaned_imdb_movies
query = "SELECT * FROM `cinemaparadiso-462409.cinema_paradiso.fa_list_statistics_imdb_merged_bygenre`"
df_movie_scores = client.query(query).to_dataframe()

# create a list with all the genres
genres_list = ['genre_action', 'genre_adventure', 'genre_animation',
       'genre_comedy', 'genre_crime', 'genre_documentary', 'genre_drama',
       'genre_family', 'genre_fantasy', 'genre_history', 'genre_horror',
       'genre_musical', 'genre_music', 'genre_mystery', 'genre_romance',
       'genre_scifi','genre_thriller', 'genre_war',
       'genre_western', 'genre_biography', 'genre_film_noir']

# Do a for loop to access all the genres in the list genres_list.
# In each iteration, gropu by the corresponding genre (only where the value is 1) and calculate the mean of the weighted score.
# In each iretarion, add list with the mean weithed score and as the key we store the genre. We add every iteratio in the created empty dictionary.
dict = {}

for genres in genres_list:
  genre_ratings_score = df_movie_scores.groupby(genres)["weighted_score"].mean().loc[1,]
  dict[genres.replace("genre_","",1)] = [genre_ratings_score]

# transform the dictionary into a dataframe with column names
df_movie_scores_by_genre = pd.DataFrame(dict).transpose().reset_index().rename(columns={"index":"genre",0:"weighted_score"})

# create a csv file
csv_filename = 'fa_general_movie_scores_by_genre_nogh'
fa_general_movie_scores_by_genre_nogh.to_csv(csv_filename, index=False)
